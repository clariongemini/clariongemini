# ProSiparis API v7.4 - Merkezi Medya Servisi ve Dosya Yükleme

Bu sürüm, platformun en kritik işlevsel eksikliklerinden birini giderir: **Dosya Yükleme**. Bu, hem yeni bir merkezi **Medya-Servisi**'nin (backend) kurulmasını hem de mevcut frontend modüllerinin (Ürün ve Banner Yönetimi) bu yeni servisi kullanacak şekilde refaktör edilmesini içeren, kapsamlı bir "tam yığın" geliştirmedir.

## v7.4 Yenilikleri

- **Yeni Servis: Medya-Servisi:** Platformdaki tüm medya varlıklarını (resim, video, PDF vb.) yönetmekten sorumlu, merkezi ve tek sorumlu bir `medya-servisi` kuruldu.
- **Dosya Yükleme API'si:** Yeni servis, `multipart/form-data` kabul eden, dosyaları sunucuya kaydeden ve veritabanında yöneten güvenli bir `POST /api/admin/medya/yukle` endpoint'i sunar.
- **Yeni Frontend Modülü: Medya Kütüphanesi:** Admin paneline, yüklenmiş tüm medyaların görüntülendiği, yenilerinin yüklenebildiği ve mevcutların silinebildiği bir `/admin/medya` sayfası eklendi.
- **Mevcut Modüllerin Refaktörü:** Ürün ve Banner Yönetimi modüllerindeki "manuel URL girişi" alanları, Medya Kütüphanesi'ni bir modal içinde açan ve kullanıcının görsel seçmesine olanak tanıyan modern bir "Medya Seçici" arayüzü ile değiştirildi. Bu, bu modülleri "prototip" olmaktan çıkarıp, **%100 işlevsel** hale getirmiştir.

## Mimari Konseptler (v7.4 Güncellemeleri)

- **Merkezi Medya Yönetimi (Cross-Cutting Concern):** Medya (dosya) yönetimi, tek bir servise (Katalog veya CMS gibi) ait bir sorumluluk değildir; platform genelinde bir ihtiyaçtır (`cross-cutting concern`). Bu nedenle, bu işlevi her servise kopyalamak yerine, tüm servislerin API aracılığıyla konuşabileceği merkezi bir **Medya-Servisi** kurmak, kod tekrarını önleyen, bakımı kolaylaştıran ve ölçeklenebilirliği artıran doğru mimari yaklaşımdır.
- **Yeniden Kullanılabilir Frontend Bileşeni (`MediaSelector`):** Farklı formlarda (Ürün, Banner vb.) medya seçimi ihtiyacını karşılamak için, Medya Kütüphanesi'ni bir modal içinde açan ve seçilen dosyanın URL'sini forma geri bildiren `MediaSelector.jsx` adında yeniden kullanılabilir bir React bileşeni oluşturulmuştur. Bu, gelecekte dosya seçimi gerektiren herhangi bir forma bu özelliğin kolayca eklenmesini sağlar.

## Servisler Arası İletişim Akışı

1.  **Admin UI (React)**, `MediaSelector` bileşeni aracılığıyla yeni bir dosya yükleme isteği başlatır.
2.  İstek, `multipart/form-data` olarak **Gateway-Servisi**'ne gönderilir -> `POST /api/admin/medya/yukle`
3.  **Gateway-Servisi**, isteği alır, JWT'yi doğrular ve `medya_yonet` yetkisini kontrol eder.
4.  Yetki varsa, istek yeni **Medya-Servisi**'ne yönlendirilir.
5.  **Medya-Servisi**, dosyayı `/uploads` klasörüne kaydeder, veritabanına bir kayıt ekler ve dosyanın URL'sini içeren bir yanıt döner.
6.  **Admin UI**, bu yanıta göre (veya Medya Kütüphanesi'nden bir seçim yaparak) Ürün veya Banner formundaki ilgili görsel alanını günceller.

## API Endpoint'leri (v7.4)

### Auth-Servisi (Güncelleme)
-   **Yeni Yetki:** `yetkiler` tablosuna `medya_yonet` yetkisi eklendi.

### Medya-Servisi (YENİ Servis ve Endpoint'ler)
-   **`POST /api/admin/medya/yukle`**: `multipart/form-data` ile yeni bir medya dosyası yükler. (Yetki: `medya_yonet`)
-   **`GET /api/admin/medya`**: Yüklenmiş tüm medya dosyalarını listeler. (Yetki: `medya_yonet`)
-   **`DELETE /api/admin/medya/:dosyaId`**: Belirli bir medya dosyasını sunucudan ve veritabanından siler. (Yetki: `medya_yonet`)
