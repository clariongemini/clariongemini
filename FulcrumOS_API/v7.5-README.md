# ProSiparis API v7.5 - Yönetim Paneli (Faz 5: Sipariş ve Denetim Kaydı)

Bu sürüm, ProSiparis Yönetim Paneli'ne platformun ticari ve operasyonel kalbi olan **Sipariş Yönetimi** modülünü ekler. En kritik eklemelerden biri, tüm sipariş eylemlerini kaydeden **Denetim Kaydı (Audit Log)** altyapısıdır. Bu, hem backend hem de frontend katmanlarında geliştirmeler içeren, kapsamlı bir "tam yığın" güncellemedir.

## v7.5 Yenilikleri

- **Yeni Frontend Modülü: Sipariş Yönetimi:** Admin paneline, siparişleri listeleme, detaylarını görüntüleme, durumlarını güncelleme ve kargo bilgisi ekleme yeteneklerini sunan tam özellikli bir modül eklendi.
- **Yeni Altyapı: Denetim Kaydı (Audit Log):** Bir siparişin durumu veya kargo bilgisi her değiştiğinde, bu değişikliği kimin ve ne zaman yaptığını kaydeden bir `siparis_gecmisi_loglari` tablosu ve ilgili iş mantığı Siparis-Servisi'ne eklendi.
- **Sipariş Geçmişi Görünümü:** Sipariş Detay Sayfası'na, o siparişe ait tüm denetim kayıtlarını kronolojik olarak gösteren bir "Sipariş Geçmişi" bölümü eklendi.
- **Yeni Backend Yetkisi ve API'leri:** `Auth-Servisi`'ne `siparis_yonet` yetkisi eklendi ve `Siparis-Servisi`, bu yetkiyle korunan `/api/admin/siparisler` ve `/api/admin/siparisler/:id/gecmis` gibi yeni endpoint'lerle güçlendirildi.

## Mimari Konseptler (v7.5 Güncellemeleri)

- **Kurumsal Güvenilirlik için Denetim Kaydı:** Bir sipariş üzerinde yapılan her işlemin kaydedilmesi (Audit Log), platformu basit bir e-ticaret sitesinden, operasyonel sorumlulukların ve hataların takip edilebildiği kurumsal bir sisteme dönüştürür. Bu özellik, `SiparisService` içinde, `X-User-ID` başlığından işlem yapan kullanıcıyı alıp veritabanına kaydeden merkezi bir `logYaz` metodu ile implemente edilmiştir.
- **Okuma ve Yazma Sorumluluklarının Ayrılması:** Sipariş modülü, iki ana bileşenle "okuma" ve "yazma" sorumluluklarını ayırır: `OrderListPage` (çoklu okuma) ve `OrderDetailPage` (tekil okuma ve yazma eylemlerini tetikleme). Bu, React bileşenlerinin odaklanmış ve yönetilebilir kalmasını sağlar.

## Servisler Arası İletişim Akışı

1.  **Admin UI (React)**, bir siparişin durumunu `OrderStatusUpdateModal` üzerinden günceller -> `PUT /api/admin/siparisler/:id/durum`
2.  **Gateway-Servisi** isteği alır, JWT'yi doğrular, `siparis_yonet` yetkisini kontrol eder ve `X-User-ID` başlığını ekleyerek isteği **Siparis-Servisi**'ne yönlendirir.
3.  **Siparis-Servisi**, `guncelleSiparisDurumu` metodunu çalıştırır.
4.  Metod, siparişin durumunu günceller VE `logYaz` metodunu çağırarak `siparis_gecmisi_loglari` tablosuna "Durum 'X' iken 'Y' olarak değiştirildi" şeklinde bir kayıt atar.
5.  Admin, Sipariş Detay sayfasını yenilediğinde, Admin UI hem `GET /api/admin/siparisler/:id` hem de `GET /api/admin/siparisler/:id/gecmis` endpoint'lerini çağırarak hem güncel durumu hem de bu değişikliğin geçmiş kaydını görür.

## API Endpoint'leri (v7.5)

### Auth-Servisi (Güncelleme)
-   **Yeni Yetki:** `yetkiler` tablosuna `siparis_yonet` yetkisi eklendi.

### Siparis-Servisi (Güncelleme ve YENİ Endpoint'ler)
-   **Yeni Tablo:** `siparis_gecmisi_loglari` tablosu eklendi.
-   **`GET /api/admin/siparisler`**: Tüm siparişlerin özet bir listesini döner.
-   **`GET /api/admin/siparisler/:siparisId`**: Belirli bir siparişin detaylarını döner.
-   **`GET /api/admin/siparisler/:siparisId/gecmis` (YENİ)**: Belirli bir siparişin denetim kaydı geçmişini döner.
-   **`PUT /api/admin/siparisler/:siparisId/durum`**: Bir siparişin durumunu günceller ve log atar.
-   **`POST /api/admin/siparisler/:siparisId/kargo`**: Bir siparişe kargo bilgisi ekler, durumunu günceller ve log atar.
(Tüm endpoint'ler `siparis_yonet` yetkisi gerektirir.)
